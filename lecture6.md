# Инфраструктура открытых ключей (PKI)

### Криптография с открытым ключом 

1. Алиса генерирует закрытый ключ 
2. Алиса генерирует открытый ключ
3. Алиса отправляет открытый ключ Бобу по открытому каналу
4. Боб шифрует сообщение на открытом ключе Алисы и отправляет его Алисе по открытому каналу
5. Алиса 

### Недостатки 

- проблема распространения ключей (когда много пользователей)
- как проверить подлинность открытого ключа

> PKI - Public Key Infrastructure

- Certificate Authority (УЦ) - сущность, которой все доверяют
- УЦ выпускает сертификаты (сертификат - открытый ключ субъекта, подписанный закрытым ключом УЦ)

### Инфраструктура PKI 

- корневой УЦ (root CA)
- подчиненные УЦ (Intermediate CA)
- Защищенное хранилище для закрытого ключа (HSM)
- набор политик и регламентов
- каталог выданных сертификатов
- каталог отозванных сертификатов


#### PKI

1. Алиса генерирует закрытый ключ
2. Алиса генерирует CSR
3. Алиса отправляет CSR в УЦ 
4. УЦ подписывает CSR своим закрытым ключом, выпуская сертификат (CER)
5. Боб получает CER Алисы из публичного каталога 
6. Боб проверяет валидность CER и шифрует сообщения на нем



### Стандарт X.509

Разработан в 1988 году в RSA
Определяет:

- Стандартную структуру сертификата
- Стандартные процедуры запроса и отзыва
- Стандарты на проверку валидности

### Структура X.509 сертификата

- Serial Number
- Issuer
- Validity (NotBefore, NotAfter)
- Subject 
- Subject Public Key Info (Algorithm, Key)
- Extensions 
- Certificate Signature Algorithm
- Certificate Signature 

Форматы сертификатов:

- PEM (base64) 
- DER (binary)
- PKCS#12 (контейнер)

### Certificate Signature Algorithm

- MD5 - мертв (уже взломан, есть колизии)
- SHA-1 - медленно помирает (взломан)
- SHA-2 - наше завтра


